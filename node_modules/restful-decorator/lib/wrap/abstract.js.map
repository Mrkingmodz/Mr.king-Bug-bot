{"version":3,"file":"abstract.js","sourceRoot":"","sources":["abstract.ts"],"names":[],"mappings":"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","sourcesContent":["import 'reflect-metadata';\nimport createMethodBuilder from './decorators/build';\nimport { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';\nimport { _chkSettingUpdate, _getSetting, fixRequestConfig } from '../util/config';\nimport subobject from '../helper/subobject';\nimport { IUrlLike } from '../util/url';\nimport { Once } from 'lodash-decorators';\nimport { mergeClone } from '../util/merge';\nimport {\n\t_habdleParamInfo,\n\t_ParamInfoToArgv,\n\tgetParamMetadata,\n\tIEnumRestClientMetadataParam,\n\tIEnumRestClientMetadataParamMap,\n\tIParameter,\n\tIParamMetadata,\n} from '../decorators/body';\nimport { IHandleDescriptorReturn2 } from '../decorators/build';\nimport { EnumRestClientMetadata } from '../decorators/http';\nimport routerToRfc6570 from 'router-uri-convert';\nimport { expand } from 'router-uri-convert/parser';\nimport { includesKey } from '../util/util';\nimport { axios, IAxiosDefaultsHeaders } from '../types/axios';\nimport { IPropertyKey } from 'reflect-metadata-util';\nimport CookieJarSupport, { getCookieJar } from '../decorators/config/cookies';\nimport { LazyCookieJar } from 'lazy-cookies';\nimport { fixAxiosCombineURLs } from '../fix/axios';\nimport parseRouterVars from 'router-uri-convert/parser';\nimport lodash_defaults from 'lodash/defaults';\nimport { CookieJar } from 'tough-cookie';\n\nexport interface IAbstractHttpClientCache\n{\n\trequestConfig: AxiosRequestConfig,\n\tbool: boolean,\n\trequestConfigNew: AxiosRequestConfig,\n\tparamMetadata: IParamMetadata,\n\trouter: string,\n\tpathData: Record<string, string>,\n}\n\nexport const methodBuilder = createMethodBuilder<any, IAbstractHttpClientCache>(function (data)\n{\n\tlet {\n\t\ttarget,\n\t\tpropertyName,\n\t\tthisArgv,\n\t\tmethod,\n\t\targv,\n\t} = data;\n\n\tconst requestConfig = _getSetting<AxiosRequestConfig>(thisArgv, {}, propertyName);\n\n\tlet paramMetadata = getParamMetadata(thisArgv, propertyName);\n\n\tparamMetadata = _habdleParamInfo({\n\t\tparamMetadata,\n\t\targv,\n\t});\n\n\targv = _ParamInfoToArgv(paramMetadata, argv);\n\n\tparamMetadata = _habdleParamInfo({\n\t\tparamMetadata,\n\t\targv,\n\t});\n\n\tconst { bool, requestConfigNew } = _chkSettingUpdate<AxiosRequestConfig>({}, requestConfig);\n\n\tif (thisArgv.$parent == null || thisArgv.$parent === thisArgv)\n\t{\n\t\tthisArgv = subobject({}, thisArgv);\n\t}\n\n\tconst _ret = paramMetadataRequestConfig({\n\t\trequestConfig: requestConfigNew,\n\t\tparamMetadata,\n\t\tthisArgv: thisArgv as any,\n\t});\n\n\tthisArgv.$pathData = _ret.pathData;\n\tthisArgv.$url = _ret.url;\n\tthisArgv.$requestConfig = _ret.requestConfig;\n\n\tdelete data.requestConfigNew;\n\n\treturn <IHandleDescriptorReturn2<AbstractHttpClient, IAbstractHttpClientCache>>{\n\t\t...data,\n\t\trequestConfig: requestConfigNew,\n\t\tthisArgv,\n\t\tparamMetadata,\n\t\targv,\n\t\trouter: thisArgv.$url,\n\t\tpathData: _ret.pathData,\n\t};\n});\n\n@CookieJarSupport(true)\nexport class AbstractHttpClient\n{\n\tpublic $parent: this = null;\n\tpublic $http: AxiosInstance = axios.create();\n\tpublic $requestConfig: AxiosRequestConfig = {};\n\tpublic $url: IUrlLike;\n\tpublic $pathData: Record<string, string>;\n\tpublic $returnValue: AxiosResponse<unknown> | AxiosResponse<unknown>[\"data\"];\n\tpublic $responseUrl: string;\n\tpublic $sharedPreferences = new Map<IPropertyKey, unknown>();\n\tpublic $response: AxiosResponse<unknown>;\n\n\tconstructor(defaults?: AxiosRequestConfig, ...argv: any)\n\t{\n\t\tthis.$http = axios.create(defaults = this._init(defaults, ...argv));\n\n\t\t// @FIXME fix miss jar field\n\t\tthis.$http.defaults.jar = defaults.jar;\n\n\t\t//console.dir(this.$http.defaults.jar);\n\n\t\t//this.$http.defaults.headers.common.Authorization;\n\t}\n\n\t@Once\n\tprotected _init(defaults?: AxiosRequestConfig, ...argv: any)\n\t{\n\t\tconst opts = mergeClone<AxiosRequestConfig>({}, _getSetting(this, {}), defaults);\n\n\t\tconst headers = opts.headers as IAxiosDefaultsHeaders;\n\n\t\tif (headers && !includesKey(headers, [\n\t\t\t'common',\n\t\t\t'delete',\n\t\t\t'get',\n\t\t\t'patch',\n\t\t\t'post',\n\t\t\t'put',\n\t\t]))\n\t\t{\n\t\t\topts.headers = {\n\t\t\t\t...headers,\n\t\t\t\tcommon: headers,\n\t\t\t};\n\t\t}\n\n\t\treturn opts;\n\t}\n\n\tget $jar(): LazyCookieJar\n\t{\n\t\t//return getCookieJar(this, propertyName);\n\t\treturn this.$http.defaults.jar as any\n\t}\n\n\tget $baseURL(): string\n\t{\n\t\treturn this.$http.defaults.baseURL\n\t}\n\n\t_serialize(jar?: CookieJar)\n\t{\n\t\treturn (jar || this._jar()).serializeSync()\n\t}\n\n\t_jar(): LazyCookieJar\n\t{\n\t\treturn this.$jar || getCookieJar(this)\n\t}\n\n\t_setCookieSync(...argv: Parameters<LazyCookieJar[\"setCookieSync\"]>)\n\t{\n\t\tif (argv[1] == null)\n\t\t{\n\t\t\targv[1] = this.$baseURL;\n\t\t}\n\n\t\treturn this._jar().setCookieSync(...argv);\n\t}\n\n\t/**\n\t * run this api before start calling site api\n\t * this will not auto call, need run by self\n\t */\n\tasync _beforeStart()\n\t{\n\t}\n\n}\n\nexport function paramMetadataRequestConfig(_argv: {\n\tparamMetadata: IParamMetadata,\n\trequestConfig: AxiosRequestConfig,\n\tthisArgv: object,\n})\n{\n\tlet { paramMetadata, requestConfig, thisArgv } = _argv;\n\n\tconst pathData: Record<string, string> = {};\n\tconst autoData: Record<string, unknown> = {};\n\n\tObject.keys(paramMetadata)\n\t\t// @ts-ignore\n\t\t.forEach(function (key: IEnumRestClientMetadataParam | IEnumRestClientMetadataParamMap)\n\t\t{\n\t\t\tlet arr: IParameter[];\n\n\t\t\tswitch (key)\n\t\t\t{\n\t\t\t\tcase EnumRestClientMetadata.PARAM_BODY:\n\n\t\t\t\t\trequestConfig.data = paramMetadata[key].value;\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase EnumRestClientMetadata.PARAM_DATA:\n\n\t\t\t\t\tarr = paramMetadata[key];\n\n\t\t\t\t\trequestConfig.data = requestConfig.data || {};\n\n\t\t\t\t\tarr.forEach((row) =>\n\t\t\t\t\t{\n\t\t\t\t\t\trequestConfig.data[row.key] = row.value;\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase EnumRestClientMetadata.PARAM_HEADER:\n\n\t\t\t\t\tarr = paramMetadata[key];\n\n\t\t\t\t\trequestConfig.headers = requestConfig.headers || {};\n\n\t\t\t\t\tarr.forEach((row) =>\n\t\t\t\t\t{\n\t\t\t\t\t\trequestConfig.headers[row.key] = row.value;\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase EnumRestClientMetadata.PARAM_PATH:\n\n\t\t\t\t\tarr = paramMetadata[key];\n\n\t\t\t\t\tarr.forEach((row) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tpathData[row.key] = row.value as any;\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase EnumRestClientMetadata.PARAM_QUERY:\n\n\t\t\t\t\tarr = paramMetadata[key];\n\n\t\t\t\t\trequestConfig.params = requestConfig.params || {};\n\n\t\t\t\t\tarr.forEach((row) =>\n\t\t\t\t\t{\n\t\t\t\t\t\trequestConfig.params[row.key] = row.value;\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_AUTO:\n\n\t\t\t\t\tarr = paramMetadata[key];\n\n\t\t\t\t\tarr.forEach((row) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tObject.assign(autoData, row.value);\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_PATH:\n\n\t\t\t\t\tarr = paramMetadata[key];\n\n\t\t\t\t\tarr.forEach((row) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tObject.assign(pathData, row.value);\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_BODY:\n\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_DATA:\n\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_HEADER:\n\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_QUERY:\n\n\t\t\t\t\tarr = paramMetadata[key];\n\n\t\t\t\t\tlet targetField: keyof Pick<AxiosRequestConfig, 'params' | 'headers' | 'data'>;\n\n\t\t\t\t\tswitch (key)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_BODY:\n\t\t\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_DATA:\n\t\t\t\t\t\t\ttargetField = 'data';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_HEADER:\n\t\t\t\t\t\t\ttargetField = 'headers';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase EnumRestClientMetadata.PARAM_MAP_QUERY:\n\t\t\t\t\t\t\ttargetField = 'params';\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\trequestConfig[targetField] = requestConfig[targetField] || {};\n\n\t\t\t\t\tarr.forEach((row) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tlodash_defaults(requestConfig[targetField], row.value, row.defaultValue);\n\n\t\t\t\t\t\t//Object.assign(requestConfig[targetField], row.value)\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t})\n\t;\n\n\trequestConfig = fixRequestConfig(requestConfig);\n\n\tconst url = requestConfig.url;\n\n\tif (url != null)\n\t{\n\t\t//console.dir(url);\n\t\t//console.dir(pathData);\n\t\t//console.dir(routerToRfc6570(url));\n\n\t\tlet tpl = routerToRfc6570(url);\n\n\t\tlet ks1 = parseRouterVars(tpl);\n\t\tlet ks2 = Object.keys(autoData);\n\n\t\tlet ret = ks2.reduce((a, k) => {\n\n\t\t\tif (ks1.includes(k))\n\t\t\t{\n\t\t\t\ta.expand[k] = autoData[k];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ta.data[k] = autoData[k];\n\t\t\t}\n\n\t\t\treturn a;\n\t\t}, {\n\t\t\texpand: {} as Record<string, unknown>,\n\t\t\tdata: {} as Record<string, unknown>,\n\t\t});\n\n\t\tObject.assign(pathData, ret.expand);\n\n\t\trequestConfig.url = expand(tpl, pathData).url;\n\n\t\tif (Object.keys(ret.data).length)\n\t\t{\n\t\t\trequestConfig.data = requestConfig.data || {};\n\n\t\t\tObject.assign(requestConfig.data, ret.data);\n\t\t}\n\t}\n\telse if (Object.keys(autoData).length)\n\t{\n\t\trequestConfig.data = requestConfig.data || {};\n\t\tObject.assign(requestConfig.data, autoData);\n\t}\n\n\trequestConfig.url = fixAxiosCombineURLs(requestConfig.url, requestConfig, (thisArgv as AbstractHttpClient).$http);\n\n\t//console.dir(requestConfig.url);\n\n\trequestConfig = fixRequestConfig(requestConfig);\n\n\treturn {\n\t\t/**\n\t\t * url before expanded\n\t\t */\n\t\turl,\n\t\t/**\n\t\t * for router url\n\t\t */\n\t\tpathData,\n\t\t/**\n\t\t * merged request config\n\t\t */\n\t\trequestConfig,\n\t};\n}\n"]}