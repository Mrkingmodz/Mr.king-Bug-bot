{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by user on 2019/6/10.\n */\n\nimport toughCookie, { CookieJar, Store, Cookie } from 'tough-cookie';\nimport moment from 'moment';\nimport { ITSRequireAtLeastOne, ITSPickExtra, ITSRequiredWith } from 'ts-type';\nimport SymbolInspect from 'symbol.inspect';\n\nexport class LazyCookie extends toughCookie.Cookie\n{\n\tconstructor(prop: Partial<ILazyCookieProperties> = {}, ...argv: any[])\n\t{\n\t\tif (!prop.expires || prop.expires === -1)\n\t\t{\n\t\t\tprop.expires = moment().add(1, 'year');\n\t\t}\n\t\telse if (typeof prop.expires == 'number')\n\t\t{\n\t\t\tprop.expires = moment().add(prop.expires, 's');\n\t\t}\n\n\t\tfor (let key in prop)\n\t\t{\n\t\t\tif (moment.isMoment(prop[key as keyof ILazyCookieProperties]))\n\t\t\t{\n\t\t\t\t// @ts-ignore\n\t\t\t\tprop[key] = prop[key as keyof LazyCookie.Properties].toDate();\n\t\t\t}\n\t\t}\n\n\t\tsuper(prop as IToughCookieProperties);\n\t}\n\n\tstatic create(prop?: Partial<ILazyCookieProperties>, ...argv: any[])\n\t{\n\t\treturn new this(prop, ...argv)\n\t}\n\n\t/*\n\t[SymbolInspect]()\n\t{\n\t\treturn `LazyCookie(${this.toString()})`\n\t}\n\t */\n}\n\nexport interface ILazyCookieProperties extends Omit<IToughCookieProperties, 'expires' | 'creation' | 'lastAccessed'>\n{\n\texpires?: Date | moment.Moment | number;\n\tcreation?: Date | moment.Moment;\n\tlastAccessed?: Date | moment.Moment;\n}\n\nexport type ILazyCookiePropertiesInput = ITSPickExtra<ILazyCookieProperties, 'key'>\n\nexport interface IToughCookieProperties\n{\n\tkey?: string;\n\tvalue?: string;\n\texpires?: Date;\n\tmaxAge?: number | 'Infinity' | '-Infinity';\n\tdomain?: string;\n\tpath?: string;\n\tsecure?: boolean;\n\thttpOnly?: boolean;\n\textensions?: string[];\n\tcreation?: Date;\n\tcreationIndex?: number;\n\n\thostOnly?: boolean;\n\tpathIsDefault?: boolean;\n\tlastAccessed?: Date;\n}\n\nexport type ICookiesValue = string | toughCookie.Cookie | ILazyCookiePropertiesInput | LazyCookie\n\nexport type ICookiesValueRecord<T extends string> = Record<string | T, ICookiesValue>\n\nexport type ICookiesValueInput<T extends string> = ICookiesValueRecord<T> | ICookiesValue[]\n\nexport class LazyCookieJar extends toughCookie.CookieJar\n{\n\tenableLooseMode?: boolean;\n\trejectPublicSuffixes?: boolean;\n\tallowSpecialUseDomain?: boolean;\n\tpublic store?: toughCookie.Store;\n\n\tconstructor(store?: any, options = {}, data = {}, url?: string | URL)\n\t{\n\t\tsuper(store, options);\n\n\t\tthis.setData(data, url);\n\t}\n\n\tsetData<T extends string>(data: ICookiesValueInput<T>, url?: string | URL)\n\t{\n\t\turl = (url || '').toString();\n\n\t\tdata = data as Record<string, ICookiesValue>;\n\n\t\tfor (let key in data)\n\t\t{\n\t\t\tif (data[key] === null || typeof data[key] != 'object')\n\t\t\t{\n\t\t\t\tthis.setCookieSync(new LazyCookie({\n\t\t\t\t\tkey,\n\t\t\t\t\tvalue: data[key] as string,\n\t\t\t\t}), url);\n\t\t\t}\n\t\t\telse if (data[key] instanceof toughCookie.Cookie)\n\t\t\t{\n\t\t\t\tthis.setCookieSync(data[key] as any, url);\n\t\t\t}\n\t\t\telse if (data[key])\n\t\t\t{\n\t\t\t\tthis.setCookieSync(new LazyCookie(data[key] as any), url);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t_handleCookieOrString(cookieOrString: ICookiesValue,\n\t\tcurrentUrl?: string | URL)\n\t{\n\t\tif (typeof cookieOrString == 'string')\n\t\t{\n\t\t\tcookieOrString = toughCookie.Cookie.parse(cookieOrString);\n\t\t}\n\t\telse if (!(cookieOrString instanceof toughCookie.Cookie))\n\t\t{\n\t\t\tcookieOrString = new LazyCookie(cookieOrString);\n\t\t}\n\n\t\tif (!currentUrl)\n\t\t{\n\t\t\tif (cookieOrString instanceof toughCookie.Cookie)\n\t\t\t{\n\t\t\t\tcurrentUrl = `http://` + cookieOrString.canonicalizedDomain();\n\t\t\t}\n\t\t}\n\t\telse if (typeof currentUrl != 'string')\n\t\t{\n\t\t\tcurrentUrl = currentUrl.toString();\n\t\t}\n\n\t\treturn {\n\t\t\tcookieOrString,\n\t\t\tcurrentUrl,\n\t\t}\n\t}\n\n\tsetCookie(cookieOrString: ICookiesValue, currentUrl: string | URL, options: CookieJar.SetCookieOptions, cb: (err: Error | null, cookie: Cookie) => void): void;\n\tsetCookie(cookieOrString: ICookiesValue, currentUrl: string | URL, cb: (err: Error, cookie: Cookie) => void): void;\n\tsetCookie(cookieOrString: ICookiesValue, currentUrl?: any, ...argv: any[])\n\t{\n\t\t({ cookieOrString, currentUrl } = this._handleCookieOrString(cookieOrString, currentUrl));\n\n\t\t// @ts-ignore\n\t\treturn super.setCookie(cookieOrString as toughCookie.Cookie, currentUrl as string, ...argv)\n\t}\n\n\n\tsetCookieSync(cookieOrString: ICookiesValue,\n\t\tcurrentUrl?: string | URL,\n\t\toptions: toughCookie.CookieJar.SetCookieOptions = {},\n\t\t...argv: any[]\n\t): void\n\t{\n\t\t({ cookieOrString, currentUrl } = this._handleCookieOrString(cookieOrString, currentUrl));\n\n\t\t// @ts-ignore\n\t\treturn super.setCookieSync(cookieOrString as toughCookie.Cookie, currentUrl as string, options, ...argv)\n\t}\n\n\tfindCookieByKey(key: string | RegExp | ((cookie: Cookie) => boolean), currentUrl?: string | URL)\n\t{\n\t\tlet fn: ((cookie: Cookie) => boolean);\n\n\t\tif (typeof key === 'string')\n\t\t{\n\t\t\tfn = (v => v.key === key);\n\t\t}\n\t\telse if (key instanceof RegExp)\n\t\t{\n\t\t\tfn = (v => key.test(v.key));\n\t\t}\n\t\telse if (typeof key === 'function')\n\t\t{\n\t\t\tfn = key;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new TypeError(`search key is not allow`)\n\t\t}\n\n\t\tlet cookies: Cookie[];\n\n\t\tif (currentUrl != null)\n\t\t{\n\t\t\tcookies = this.getCookiesSync(currentUrl.toString())\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcookies = this.getAllCookies();\n\t\t}\n\n\t\treturn cookies\n\t\t\t.filter(fn)\n\t}\n\n\tdeleteCookieSync(key: string | RegExp | ((cookie: Cookie) => boolean), currentUrl?: string | URL)\n\t{\n\t\tlet cs = this.findCookieByKey(key, currentUrl);\n\n\t\tcs\n\t\t\t.forEach(v => {\n\t\t\t\tv.setMaxAge(-1);\n\t\t\t\tv.expiryTime(0);\n\t\t\t\tv.value = '';\n\t\t\t})\n\t\t;\n\n\t\treturn cs;\n\t}\n\n\tstatic create(store?: any, options = {}, data = {}, url?: string | URL)\n\t{\n\t\treturn new this(store, options, data, url);\n\t}\n\n\tgetAllCookies()\n\t{\n\t\tlet cookies: toughCookie.Cookie[];\n\n\t\tthis.store.getAllCookies(function (err, cookie)\n\t\t{\n\t\t\tcookies = cookie;\n\t\t});\n\n\t\treturn cookies;\n\t}\n\n\tstatic deserialize(serialized: CookieJar.Serialized | string, store: Store, cb: (err: Error | null, object: CookieJar) => void): void;\n\tstatic deserialize(serialized: CookieJar.Serialized | string, cb: (err: Error | null, object: CookieJar) => void): void;\n\tstatic deserialize(...argv: any[]): void\n\t{\n\t\tlet cb: Function;\n\t\tif (argv.length !== 3)\n\t\t{\n\t\t\tcb = argv[1];\n\t\t}\n\t\telse if (argv.length)\n\t\t{\n\t\t\tcb = argv[argv.length - 1];\n\t\t}\n\n\t\t// @ts-ignore\n\t\tCookieJar.deserialize(...argv, (err: Error | null, _jar: LazyCookieJar) => {\n\n\t\t\tlet jar = new this(_jar.store, _jar.rejectPublicSuffixes);\n\n\t\t\tif (cb)\n\t\t\t{\n\t\t\t\tcb(this._copyCookieJar(_jar, jar));\n\t\t\t}\n\t\t})\n\t}\n\n\tstatic deserializeSync(serialized: CookieJar.Serialized | string, store?: Store)\n\t{\n\t\tlet _jar = CookieJar.deserializeSync(serialized, store) as LazyCookieJar;\n\n\t\tlet jar = new this(_jar.store, _jar.rejectPublicSuffixes);\n\t\treturn this._copyCookieJar(_jar, jar);\n\t}\n\n\tstatic fromJSON(string: string)\n\t{\n\t\treturn this.deserializeSync(string)\n\t}\n\n\tstatic createFrom(jarFrom: CookieJar | LazyCookieJar)\n\t{\n\t\tlet _jar = jarFrom as LazyCookieJar;\n\t\tlet jar = new this(_jar.store, _jar.rejectPublicSuffixes);\n\t\treturn this._copyCookieJar(_jar, jar);\n\t}\n\n\tstatic _copyCookieJar(jarFrom: CookieJar | LazyCookieJar, jarTo: LazyCookieJar)\n\t{\n\t\tjarTo.store = (jarFrom as LazyCookieJar).store;\n\t\tjarTo.rejectPublicSuffixes = (jarFrom as LazyCookieJar).rejectPublicSuffixes;\n\t\tjarTo.enableLooseMode = (jarFrom as LazyCookieJar).enableLooseMode;\n\t\tjarTo.allowSpecialUseDomain = (jarFrom as LazyCookieJar).allowSpecialUseDomain;\n\n\t\treturn jarTo;\n\t}\n\n}\n\nexport default LazyCookie\n\n"]}