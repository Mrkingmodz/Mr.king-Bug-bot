{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by user on 2019/6/9.\n */\nimport { ITSArrayListMaybeReadonly, ITSValueOrArray } from 'ts-type';\n\nconst SymTransform = Symbol('transform');\nconst SymOptions = Symbol('options');\n\nexport interface IOptions\n{\n\t/**\n\t * '&k=&v=1' => '&k&v=1'\n\t * only work for create new\n\t */\n\temptyValueToKeyOnly?: boolean,\n\t/**\n\t * transform value to x-www-form-urlencoded\n\t */\n\ttransform?: boolean,\n\n\tallowNull?: boolean,\n}\n\nexport type IURLSearchParamsInit = any[][] | [any, any][] | Record<string, any> | string | URLSearchParams;\n\nexport class LazyURLSearchParams extends URLSearchParams implements URLSearchParams\n{\n\t[SymOptions]: IOptions;\n\t[SymTransform](value: any, options?: IOptions)\n\t{\n\t\toptions = options || this[SymOptions];\n\n\t\treturn transformValue(value, options);\n\t}\n\n\tconstructor(init?: IURLSearchParamsInit, options?: IOptions)\n\t{\n\t\tif (!options)\n\t\t{\n\t\t\tif (init instanceof LazyURLSearchParams)\n\t\t\t{\n\t\t\t\toptions = Object.assign({}, init[SymOptions]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\toptions = {};\n\t\t\t}\n\t\t}\n\n\t\tif (options.transform == null)\n\t\t{\n\t\t\toptions.transform = true;\n\t\t}\n\n\t\tsuper(_core(init, options));\n\n\t\tthis[SymOptions] = options;\n\t}\n\n\t/**\n\t * all null value will transform to ''\n\t */\n\tappend(name: string, value: string | any, options?: IOptions)\n\t{\n\t\toptions = options || this[SymOptions];\n\n\t\tif (options.transform)\n\t\t{\n\t\t\tvalue = this[SymTransform](value, options)\n\t\t}\n\n\t\tsuper.append(name, value as any)\n\t}\n\n\t/**\n\t * all null value will transform to ''\n\t */\n\tset(name: string, value: string | any, options?: IOptions)\n\t{\n\t\toptions = options || this[SymOptions];\n\n\t\tif (options.transform)\n\t\t{\n\t\t\tvalue = this[SymTransform](value, options)\n\t\t}\n\n\t\tsuper.set(name, value as any)\n\t}\n\n\t/**\n\t * append\n\t */\n\tpush(...values: ITSArrayListMaybeReadonly<unknown>[])\n\t{\n\t\tvalues.forEach(([k, v]) => this.append(k as string, v));\n\t}\n\n\t/**\n\t * set\n\t */\n\textend(values: Record<any, any>, options?: IOptions)\n\t{\n\t\tObject.entries(values).forEach(([k, v]) => this.set(k as string, v, options));\n\t}\n\n\tclone<T extends URLSearchParams = LazyURLSearchParams>(): T\n\t{\n\t\treturn new LazyURLSearchParams(this) as any\n\t}\n\n\ttoString()\n\t{\n\t\treturn super.toString();\n\t}\n\n}\n\nexport function _core(init?: IURLSearchParamsInit, options?: IOptions)\n{\n\toptions = options || {};\n\n\t//console.dir(options);\n\n\tif (typeof init != 'string' && options.transform && !(init instanceof URLSearchParams) && init)\n\t{\n\t\tconst { emptyValueToKeyOnly } = options;\n\n\t\tif (!Array.isArray(init))\n\t\t{\n\t\t\tinit = Object.entries(init)\n\t\t}\n\n\t\tlet arr = (init as [string, unknown][]).reduce((arr, [key, value]) => {\n\n\t\t\tif (value == null || emptyValueToKeyOnly && value === '')\n\t\t\t{\n\t\t\t\tarr.push(transformKey(key));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlet u = new URLSearchParams();\n\t\t\t\tu.append(key, transformValue(value, options));\n\t\t\t\tarr.push(u.toString());\n\t\t\t}\n\n\t\t\treturn arr;\n\t\t}, [] as string[])\n\n\t\tinit = arr.join('&');\n\t}\n\telse if (init == null)\n\t{\n\t\tinit = void 0;\n\t}\n\n\t//console.dir(init);\n\n\treturn init;\n}\n\nexport function transformKey(value: string)\n{\n\treturn encodeURIComponent(value)\n}\n\nexport function transformValue(value: any, options?: IOptions)\n{\n\tif (value == null)\n\t{\n\t\tif (options && options.allowNull)\n\t\t{\n\t\t\treturn value\n\t\t}\n\n\t\treturn '';\n\t}\n\telse if (typeof value === 'object')\n\t{\n\t\treturn JSON.stringify(value)\n\t}\n\n\treturn value.toString();\n}\n\nexport default LazyURLSearchParams\n"]}